function Modal(t,e){this.opts=e,this.$el=t,this.$content=this.$el.find(".js-modal-content"),this.$close=this.$el.find(".js-modal-close"),this.init()}Function.prototype.bind||(Function.prototype.bind=function(t){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var e=Array.prototype.slice.call(arguments,1),n=this,i=function(){},o=function(){return n.apply(this instanceof i&&t?this:t,e.concat(Array.prototype.slice.call(arguments)))};return i.prototype=this.prototype,o.prototype=new i,o}),String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},$.fn.onTap=function(t){window.ontouchend!==void 0&&(this.each(function(){this._touchMoveCount=0}),this.on("touchmove",function(){this._touchMoveCount++}),this.on("touchend",function(e){this._touchMoveCount<3&&t.call(this,e),this._touchMoveCount=0}),this.on("click",function(){return!1}))};var EDSA_UA={};EDSA_UA.IS_TOUCH_DEVICE=window.ontouchend!==void 0,EDSA_UA.CLICK=EDSA_UA.IS_TOUCH_DEVICE?"touchend":"click",EDSA_UA.HAS_TRANSITIONS=!1,EDSA_UA.HAS_SVG=!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect,EDSA_UA.IS_RETINA="devicePixelRatio"in window&&devicePixelRatio>1||"matchMedia"in window&&matchMedia("(min-resolution:144dpi)").matches;var App=function(){function App(t){this.options={defaultTitle:document.title,currentState:null,advancedMenusOpened:!1,summaryOpened:!1,relativeSummary:!1,currentScrollTop:0,currentSection:{},currentChapter:1,currentParagraph:1,paragraphCount:1,chapterCount:1,forceChapterChange:!1,forceParagraphChange:!1,lastAnchorTypeChanged:"par",gestureTime:220,nextPageTapZone:25,maxTapZone:150,scrollPosition:0},$.extend(this.options,t),this.$els={body:$("body"),window:$(window),par:$("p, .paragraph").not(".exclude"),chap:$(".chapter").not(".exclude"),lim:$(".lim").not(".exclude"),contentWrap:$("section[role=main]"),sections:$("section[role=main] section"),currentParagraph:$('[data-hook="current-paragraph"]'),paragraphCount:$('[data-hook="paragraph-count"]'),paragraphSelect:$('select[name="par"]'),anchorsWrap:$(".anchors"),anchorsButton:$(".anchors .button"),allLinks:$('a[href^="javascript:"]:not(a[href="javascript:"])'),summaryButton:$('[data-hook="toggle-summary"]'),authorWrap:$('[data-hook="author"]'),titleWrap:$('[data-hook="textTitle"]'),closeAdvancedMenuBtn:$('[data-hook="close-advanced-menu"]'),showAdvancedMenuBtn:$('[data-hook="show-advanced-menu"]'),showTextSettingsMenuBtn:$('[data-hook="show-text-settings-menu"]'),changeLineHeightBtns:$('[data-hook="change-line-height"]'),changeFontBtns:$('[data-hook="change-font"]'),changeAlignmentBtns:$('[data-hook="change-alignment"]'),toggleSubmenuBtn:$('[data-hook="toggle-submenu"]')},$(document).on("keyup",this.handleKeyup.bind(this)),this.$els.window.on("scroll resize",this.onWindowScroll.bind(this)),this.$els.paragraphSelect.on("change",this.onParagraphSelectChange.bind(this)),this.$els.anchorsButton.on(EDSA_UA.CLICK,this.onAnchorsButtonClick.bind(this)),this.$els.summaryButton.on(EDSA_UA.CLICK,this.onSummaryButtonClick.bind(this)),this.$els.sections.find("h3:first").on("click",this.onHeadingClick.bind(this)),this.$els.closeAdvancedMenuBtn.on("click",this.hideAdvancedMenus.bind(this)),this.$els.showAdvancedMenuBtn.on("click",this.showAdvancedMenus.bind(this)),this.$els.showTextSettingsMenuBtn.on("click",this.showTextSettingsMenu.bind(this)),this.$els.changeLineHeightBtns.on("click",this.changeLineHeight.bind(this)),this.$els.changeFontBtns.on("click",this.changeFont.bind(this)),this.$els.changeAlignmentBtns.on("click",this.changeAlignment.bind(this)),this.$els.toggleSubmenuBtn.on("click",this.toggleSubmenu.bind(this)),$(".veil").on(EDSA_UA.CLICK,this.hideAdvancedMenus.bind(this)),this.init()}return App.prototype={init:function(){this.setTitle(),this.gotoCurrentAnchor(),this.setParagraphCount(),this.setChapterCount(),this.setData(),this.initClasses(),this.handleMobileDevices(),this.initStartupHint()},handleMobileDevices:function(){if(EDSA_UA.IS_TOUCH_DEVICE){var App=this;window.scrollTo(0,1),this.$els.anchorsButton=$(".anchors"),this.$els.allLinks.on("click",function(){return!1}),this.$els.allLinks.onTap(function(e){action=this.href.match(/javascript:(.+)/)[1],eval(action)}),this.$els.contentWrap.on("touchstart",this.onContentTouchStart.bind(this)),this.$els.contentWrap.on("touchend",this.onContentTouchEnd.bind(this)),this.$els.sections.find("h3:first").onTap(this.onHeadingClick.bind(this))}},getScrollTop:function(){return window.pageYOffset||(typeof this.$els.window.scrollTop=="function"?this.$els.window.scrollTop():0)},smoothScrollTo:function(t){this.$els.body.animate({scrollTop:t,duration:400})},isInTheFold:function(t){var e=t.getBoundingClientRect();return e.top<=0&&e.bottom>0?!0:!1},showNextPageHint:function(){var t=document.createElement("div");t.className="pageswipe-hint",this.$els.contentWrap.after(t),$(t).one("webkitAnimationEnd oanimationend oAnimationEnd msAnimationEnd animationend",this.onPageChangeEnded.bind(this))},showAdvancedMenus:function(t){t.preventDefault(),this.options.advancedMenusOpened||(this.options.advancedMenusOpened=!0,this.options.currentScrollTop=this.getScrollTop(),this.$els.body.addClass("show-advanced-menus"))},hideAdvancedMenus:function(t){t.preventDefault(),this.options.advancedMenusOpened&&(this.options.advancedMenusOpened=!1,ReadabilitySettings&&ReadabilitySettings.closeSubmenu(),this.$els.body.removeClass("show-advanced-menus submenu-opened"),this.$els.anchorsWrap.removeClass("opened"))},hideTextSettingsMenus:function(){this.$els.body.removeClass("show-font-size-menu show-line-height-menu show-font-family-menu show-alignment-menu"),this.options.textInfosOpened=!1},showTextSettingsMenu:function(t){t.preventDefault();var e=$(t.currentTarget).data("setting"),n=this.options.textInfosOpened==e;this.hideTextSettingsMenus(),n||(this.options.textInfosOpened=e,this.$els.body.addClass("show-"+e+"-menu"))},onContentTouchStart:function(t){this.gestureStartTime=new Date,this.gestureStartPosition=t.originalEvent.changedTouches[0].clientY,this.gestureStartScreenPosition=this.$els.window.scrollTop(),this.$els.body.stop()},onContentTouchEnd:function(t){this.gestureEndTime=new Date,this.gestureEndPosition=t.originalEvent.changedTouches[0].clientY;var e=this.gestureEndTime-this.gestureStartTime,n=this.gestureEndPosition-this.gestureStartPosition,i=n/e;if(e<=this.options.gestureTime){var o=window.innerHeight*.75,s=this.getTapZone();i||(this.gestureEndPosition>=s&&!this.options.summaryOpened?(this.showNextPageHint(),this.smoothScrollTo(this.gestureStartScreenPosition+o)):this.showAdvancedMenus())}},getTapZone:function(){var t=window.innerHeight,e=t*(this.options.nextPageTapZone/100),n=this.options.maxTapZone,i=e>n?n:e;return t-i},onPageChangeEnded:function(){$(".pageswipe-hint").remove()},onSummaryButtonClick:function(){this.options.summaryOpened?this.closeSummary():this.openSummary()},openSummary:function(){this.options.scrollPosition=this.getScrollTop(),this.$els.body.addClass("show-summary"),this.options.summaryOpened=!0,this.$els.window.scrollTop(0)},closeSummary:function(){this.$els.body.removeClass("show-summary"),this.options.summaryOpened=!1,this.$els.window.scrollTop(this.options.scrollPosition)},onHeadingClick:function(t){var e,n,i,o;this.options.summaryOpened&&(e=$(t.currentTarget),n=e.parents("section"),i=this.$els.sections.index(n),o=this.getAnchorTypeAndNumberMatchesFromEl(n[0]),this.closeSummary(),this.hideAdvancedMenus(),this.gotoAnchorFromMatches(o))},handleKeyup:function(t){var e,n;e={escape:27},n=t.keyCode?t.keyCode:t.which,n==e.escape&&(ReadabilitySettings.get("submenuOpened")?ReadabilitySettings.closeSubmenu():this.hideAdvancedMenus())},onWindowScroll:function(){var t,e,n;return t=this,e=this.getScrollTop(),n=null,this.$els.sections.each(function(e,i){return t.isInTheFold(i)?(n=i,t.setCurrentSection(t.getAnchorTypeAndNumberMatchesFromEl(i)),$(i).children("p, .paragraph").not(".exclude").each(function(e,i){return t.isInTheFold(i)?(n=i,t.setCurrentParagraph(t.getAnchorTypeAndNumberMatchesFromEl(i).number),void 0):!0}),void 0):!0}),null==n?(this.clearState(),this.setCurrentChapter(1),this.setCurrentParagraph(1),void 0):(matches=this.getAnchorTypeAndNumberMatchesFromEl(n),this.replaceStateFromMatches(matches,!1),void 0)},onAnchorsButtonClick:function(){this.$els.anchorsWrap.toggleClass("opened"),this.$els.body.toggleClass("submenu-opened")},onParagraphSelectChange:function(t){var e=t.currentTarget.value;this.replaceState(this.options.lastAnchorTypeChanged,e,!0)},getAnchorTypeAndNumberMatchesFromHref:function(t){var e=t.match(/(lim|par|chap)(\-)([0-9]+)/);return null==e?null:{type:e[1],number:e[3]}},getAnchorTypeAndNumberMatchesFromEl:function(t){var e=$(t).data("type");return e?{type:e,number:this.$els[e].index(t)+1}:null},gotoAnchor:function(t,e){var n,i;n=$(this.$els[t][e-1]),i=n.offset().top,this.$els.window.scrollTop(i),document.title=this.options.defaultTitle+" | "+t.capitalize()+" "+e},gotoAnchorFromMatches:function(t){null!=t&&this.gotoAnchor(t.type,t.number)},gotoCurrentAnchor:function(){var t,e;t=window.location.href,e=this.getAnchorTypeAndNumberMatchesFromHref(t),null!=e&&this.gotoAnchorFromMatches(e)},replaceState:function(t,e,n){if(!this.options.currentState||this.options.currentState.type!=t||this.options.currentState.number!=e){var i,o,s;i={type:t,number:e},o=this.options.defaultTitle+" | "+t.capitalize()+" "+e,s="#"+t+"-"+e,window.history.replaceState(i,o,s),this.options.currentState=i,n?this.gotoAnchor(t,e):document.title=o}},replaceStateFromMatches:function(t,e){null!=t&&this.replaceState(t.type,t.number,e)},clearState:function(){if(this.options.currentState!=null){this.options.currentState=null;var t,e,n;t={},e=this.options.defaultTitle,n="#",window.history.replaceState(t,e,n),document.title=e}},setCurrentSection:function(t){var e,n;e=t.type==this.options.currentSection.type,n=t.number==this.options.currentSection.number,e&&n||(this.options.currentSection=t,t.type=="chap"?this.setCurrentChapter(t.number):this.setCurrentChapter(1))},setCurrentChapter:function(t){var e,n,i;e=t==this.options.currentChapter,(!e||this.options.forceChapterChange)&&(i=$(this.$els.paragraphSelect.find("optgroup")[parseInt(t)+1]),n=i.find("option").first().val(),this.options.currentChapter=t,this.options.forceChapterChange=!1,this.setCurrentParagraph(n))},setCurrentParagraph:function(t){var e=t==this.options.currentParagraph;(!e||this.options.forceParagraphChange)&&(this.options.currentParagraph=t,this.options.forceParagraphChange=!1,this.$els.currentParagraph.html(t),this.$els.paragraphSelect[0].options.selectedIndex=t-1)},setParagraphCount:function(t){null==t&&(t=$("p, .paragraph").not(".exclude").length),t!=this.options.paragraphCount&&(this.options.paragraphCount=t,this.setAnchorSelect(),this.$els.paragraphCount.html(t))},setChapterCount:function(t){null==t&&(t=this.$els.chap.length),t!=this.options.chapterCount&&(this.options.chapterCount=t)},setAnchorSelect:function(){var t="",e=1;this.$els.sections.each(function(n,i){var o=$(i),s=o.find("h1, h2, h3").first().text(),a=o.find("p, .paragraph").not(".exclude").length,h=0;for(t+='<optgroup label="'+s+'">';a>h;)t+='<option value="'+e+'">'+e+"</option>",h++,e++;t+="</optgroup>"}),this.$els.paragraphSelect.html(t)},setData:function(){var t=this;$.each(["lim","par","chap"],function(e,n){t.$els[n].data("type",n)})},setTitle:function(){var t=this.$els.contentWrap.find(".author").text(),e=this.$els.contentWrap.find(".title").text();this.options.defaultTitle=t+" - "+e,document.title=this.options.defaultTitle,this.$els.authorWrap.text(t),this.$els.titleWrap.text(e)},changeSiblingAnchorSelect:function(t,e,n){t.options.selectedIndex=e-1,this.options.forceChapterChange=!0,this.options.forceParagraphChange=!0,this.options.lastAnchorTypeChanged=n},initClasses:function(){this.options.relativeSummary&&this.$els.body.addClass("relative-summary")},initStartupHint:function(){if(EDSA_UA.IS_TOUCH_DEVICE){var t=$.parseJSON(localStorage.getItem("edsa"));($.isEmptyObject(t)||t.firstVisit==1)&&(localStorage.setItem("edsa",JSON.stringify({firstVisit:!1})),this.startupHint=new Modal($(".js-startup-hint"),{openCallback:function(){this.$els.body.addClass("show-startup-hint"),document.ontouchmove=function(t){t.preventDefault()}}.bind(this),closeCallback:function(){this.$els.body.removeClass("show-startup-hint"),document.ontouchmove=function(){return!0}}.bind(this)}))}},changeLineHeight:function(t){t.preventDefault();var e=$(t.currentTarget).data("line-height");ReadabilitySettings.setLineHeight(e)},changeFont:function(t){t.preventDefault();var e=$(t.currentTarget).data("font-direction");ReadabilitySettings.cycleFont(e)},changeAlignment:function(t){t.preventDefault();var e=$(t.currentTarget).data("alignment");ReadabilitySettings.setAlignment(e)},toggleSubmenu:function(t){t.preventDefault(),ReadabilitySettings.toggleSubmenu()}},App}();Modal.prototype={init:function(){this.$close.on("click",function(){this.close()}.bind(this)),this.$el.on("click",function(){this.close()}.bind(this)),this.$content.on("click",function(t){t.stopImmediatePropagation()}),this.open()},close:function(){this.$el.addClass("hidden"),this.opts.closeCallback&&this.opts.closeCallback()},open:function(){this.$el.removeClass("hidden"),this.opts.openCallback&&this.opts.openCallback()}},window.App=new App;var ButtonsGroup=function(){function t(t,e){this.$els={group:t,buttons:t.find(".simple-button"),select:t.children("select"),selectedButton:null},this.$els.buttons.on("click",this.onButtonClick.bind(this)),this.$els.select.length&&this.initSelect(),e&&this.select(e[0])}return t.prototype={onButtonClick:function(t){this.select(t.currentTarget)},select:function(t,e){if(null==e&&(e=!0),this.$els.selectedButton!=t&&(this.unselect(),this.$els.selectedButton=t,$(t).addClass("selected"),e&&this.$els.select.length)){var n=$(t).index();this.$els.select[0].selectedIndex=n}},unselect:function(){$(this.$els.selectedButton).removeClass("selected")},initSelect:function(){var t=this;this.$els.select.on("change",function(){var e=t.$els.buttons.eq(this.selectedIndex);t.select(e[0],!1),t.$els.group.trigger("selectChange",this.value)})}},t}(),ReadabilitySettings=function(){function t(){this.options={submenuOpened:!1,fontSize:{"default":0,current:0},lineHeight:{"default":0,current:0},alignment:{"default":null,current:null},theme:{"default":null,current:null},fontFamily:{"default":null,current:null}},this.$els={body:$("body"),main:$('[role="main"]'),veil:$(".veil"),fontSizeButtons:$(".font-size a"),lineHeightButtons:$(".line-height a"),alignmentButtons:$(".alignment a"),fontFamilyPrev:$(".js-prev-font"),fontFamilyNext:$(".js-next-font"),fontFamilyExample:$(".js-font-example"),fontFamilyName:$(".js-font-name"),fontFamilyChoices:$(".js-font-choices")};var t=window.getComputedStyle(this.$els.main[0]);this.initialStyles={fontSize:parseInt(t.getPropertyValue("font-size")),lineHeight:parseInt(t.getPropertyValue("line-height")),alignment:t.getPropertyValue("text-align"),theme:this.$els.body[0].className.match(/theme-([a-zA-Z0-9]+)/)[1],fontFamily:this.$els.main[0].className.match(/font-([a-zA-Z0-9]+)/)[1]},this.init()}return t.prototype={init:function(){$.each(this.initialStyles,function(t,e){this.setInitialOption(t,e)}.bind(this)),this.applySavedSettings(),this.initAlignmentButtonsGroup(),this.initThemeSlider(),this.initFontSizeButtons(),EDSA_UA.IS_TOUCH_DEVICE?this.$els.veil.onTap(this.closeSubmenu.bind(this)):this.$els.veil.on("click",this.closeSubmenu.bind(this))},initFontSizeButtons:function(){$("[data-font-size]").on("click",function(t){t.preventDefault();var e=$(t.currentTarget);this.setFontSize(e.data("font-size"))}.bind(this))},applySavedSettings:function(){var t=JSON.parse(localStorage.getItem("readabilitySettings"));t&&(this.setFontSize(t.fontSize),this.setLineHeight(t.lineHeight),this.setAlignment(t.alignment),this.setFontFamily(t.fontFamily),this.setTheme(t.theme))},get:function(t){return this.options[t]},setInitialOption:function(t,e){e&&("lineHeight"==t&&(e=this.getRoundedLineHeight(e)),this.options[t].default=e,this.options[t].current=e)},toggleSubmenu:function(){this.options.submenuOpened?this.closeSubmenu():this.openSubmenu()},openSubmenu:function(){this.options.submenuOpened||(this.options.submenuOpened=!0,this.$els.body.addClass("show-readability-settings submenu-opened"))},closeSubmenu:function(){this.options.submenuOpened&&(this.options.submenuOpened=!1,this.$els.body.removeClass("show-readability-settings submenu-opened"))},largerFontSize:function(){this.changeFontSize(1)},smallerFontSize:function(){this.changeFontSize(-1)},normalFontSize:function(){this.setFontSize(this.options.fontSize.default)},changeFontSize:function(t){var e=this.options.fontSize.current+t;this.setFontSize(e)},setFontSize:function(t){t&&(this.$els.fontSizeButtons.removeClass("active"),this.$els.fontSizeButtons.filter('[data-font-size="'+t.toString()+'"]').addClass("active"),this.options.fontSize.current==t||t>3||(this.options.fontSize.current=t,this.updateLocalStorage("fontSize",t),this.$els.main.css("font-size",t+"em")))},largerLineHeight:function(){this.changeLineHeight(1)},smallerLineHeight:function(){this.changeLineHeight(-1)},normalLineHeight:function(){this.setLineHeight(this.options.lineHeight.default)},getRoundedLineHeight:function(t){var e;return t/=this.options.fontSize.default,e=Math.round(10*t)/10},changeLineHeight:function(t){var e=(this.options.lineHeight.current*10+t)/10;this.setLineHeight(e)},setLineHeight:function(t){t&&(this.$els.lineHeightButtons.removeClass("active"),this.$els.lineHeightButtons.filter(".line-height-"+10*t).addClass("active"),this.options.lineHeight.current!=t&&(this.options.lineHeight.current=t,this.updateLocalStorage("lineHeight",t),this.$els.main.css("line-height",t)))},leftAlignment:function(){this.setAlignment("left")},justifyAlignment:function(){this.setAlignment("justify")},initAlignmentButtonsGroup:function(){var t,e,n;e=$(".alignments"),n=e.find(".alignment-"+this.options.alignment.current),t=new ButtonsGroup(e,n)},setAlignment:function(t){if(t&&(this.$els.alignmentButtons.removeClass("active"),this.$els.alignmentButtons.filter(".alignment-"+t).addClass("active"),this.options.alignment.current!=t)){var e=this.options.alignment.current;this.options.alignment.current=t,this.updateLocalStorage("alignment",t),this.$els.main.removeClass("align-"+e),this.$els.main.addClass("align-"+t)}},updateLocalStorage:function(t,e){var n=JSON.parse(localStorage.getItem("readabilitySettings"))||{};n[t]=e,localStorage.setItem("readabilitySettings",JSON.stringify(n))},initThemeSlider:function(){var t=this.setTheme.bind(this);$(".slider-container .slider").slider({value:this.options.theme.current,min:1,max:5,step:1,slide:function(e,n){t(n.value)}})},setTheme:function(t){if(t&&this.options.theme.current!=t){var e=this.options.theme.current;this.options.theme.current=t,this.updateLocalStorage("theme",t),this.$els.body.removeClass("theme-"+e),this.$els.body.addClass("theme-"+t)}},fontFamily:function(t){this.setFontFamily(t)},initFontFamilyButtonsGroup:function(){var t,e,n,i;t=this,n=$(".buttons-group.fonts"),i=n.find(".font-"+this.options.fontFamily.current),n.on("selectChange",function(e,n){t.fontFamily(n)}),e=new ButtonsGroup(n,i)},setFontFamily:function(t){if(t){var e=this.options.fontFamily.current;this.options.fontFamily.current=t,this.updateFontFamilyPreviewer(e,t),e!=t&&(this.updateLocalStorage("fontFamily",t),this.$els.main.removeClass("font-"+e),this.$els.main.addClass("font-"+t))}},cycleFont:function(t){this.retrieveFontFamilyNode(this.options.fontFamily.current);var e=this.retrieveFontFamilyNode(this.options.fontFamily.current).index(),n=this.$els.fontFamilyChoices.find("option"),i=e+t;targetIndex=i>n.length-1?0:i,targetOption=n.eq(targetIndex),this.setFontFamily(targetOption.attr("value"))},nextFont:function(){this.cycleFont(1)},prevFont:function(){this.cycleFont(-1)},retrieveFontFamilyNode:function(t){var e='option[value="'+t+'"]';return this.$els.fontFamilyChoices.find(e)},retrieveFontFamilyDisplayName:function(t){return this.retrieveFontFamilyNode(t).text()},updateFontFamilyPreviewer:function(t,e){this.$els.fontFamilyExample.removeClass("font-"+t),this.$els.fontFamilyExample.addClass("font-"+e),this.$els.fontFamilyName.text(this.retrieveFontFamilyDisplayName(e))}},t}();window.ReadabilitySettings=new ReadabilitySettings;